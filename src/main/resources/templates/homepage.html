<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Shop</title>
    <link rel="stylesheet" href="/homepage.css" th:href="@{/homepage.css}" />
    <script src="/homepage.js"></script>
    <style>
        /* --------------------
           Bi·∫øn m√†u ch√≠nh
           -------------------- */
        :root {
            --blue: #2563eb;
            --blue-dark: #1d4ed8;
            --accent: #f43f5e; /* m√†u ƒë·ªè/ƒë·∫≠m cho n√∫t th√™m gi·ªè */
            --white-90: rgba(255,255,255,0.9);
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-600: #6c757d;
            --gray-800: #343a40;
        }

        /* --------------------
           Reset & body
           -------------------- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f8f9fa;
            color: #111;
            transition: padding-top 160ms ease;
        }

        /* --------------------
           Header (fixed) & search
           -------------------- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--blue);
            color: white;
            padding: 15px 20px;
            display: block;
            transition: all 0.28s cubic-bezier(.2,.9,.2,1);
            z-index: 1200;
            will-change: padding, box-shadow, backdrop-filter;
            backdrop-filter: blur(0px);
        }

        /* compact state khi scroll */
        header.compact {
            box-shadow: 0 4px 18px rgba(16,24,40,0.12);
            backdrop-filter: blur(4px);
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        header h1 {
            font-size: 20px;
            margin: 0;
            white-space: nowrap;
            transition: transform 0.28s, font-size 0.28s;
        }

        /* Khi compact, thu nh·ªè ti√™u ƒë·ªÅ 1 ch√∫t */
        header.compact .header-inner h1 {
            transform: translateY(-1px);
            font-size: 16px;
        }

        /* search box ch·ª©a input + clear */
        .search-box { flex: 1; display: flex; justify-content: center; }
        .search-controls { display: flex; gap: 8px; align-items: center; width: 100%; max-width: 600px; }
        .search-controls input {
            flex: 1;
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            outline: none;
            box-sizing: border-box;
            transition: padding 0.2s, font-size 0.2s;
        }
        header.compact .search-controls input {
            padding: 8px 10px;
            font-size: 13px;
        }
        .search-clear {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        .search-clear.hidden { display: none; opacity: 0; }

        /* Actions (Login/Register/Cart) */
        .actions { display: flex; gap: 8px; align-items: center; }

        /* Reset chung cho n√∫t trong header */
        .actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-sizing: border-box;
            transition: transform 140ms ease, box-shadow 140ms ease, opacity 160ms ease;
            white-space: nowrap;
        }

        /* N√∫t ƒêƒÉng nh·∫≠p: outline tr·∫Øng (trong su·ªët) */
        .auth-login {
            background: transparent;
            color: var(--white-90);
            border: 1.5px solid rgba(255,255,255,0.18);
            padding: 8px 14px;
        }
        .auth-login:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(37,99,235,0.08); }

        /* N√∫t ƒêƒÉng k√Ω: filled ƒë·ªÉ n·ªïi b·∫≠t */
        .auth-register {
            background: white;
            color: var(--blue);
            border: 1.5px solid rgba(0,0,0,0.06);
            padding: 9px 14px;
        }
        .auth-register:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,99,235,0.08); }

        /* N√∫t Tr·ª£ l√Ω ·∫£o, Gi·ªè h√†ng, H·ªó tr·ª£: gi·ªëng style .auth-login (transparent, border white m·ªù) */
        .assistant-btn, .cart-btn, .support-btn {
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-sizing: border-box;
            transition: transform 140ms ease, box-shadow 140ms ease, opacity 160ms ease;
            white-space: nowrap;
            background: transparent;
            color: var(--white-90);
            border: 1.5px solid rgba(255,255,255,0.18);
            padding: 8px 14px;
            text-decoration: none;
        }
        .assistant-btn:hover, .cart-btn:hover, .support-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(37,99,235,0.08); }

        /* Khi header compact, gi·∫£m k√≠ch th∆∞·ªõc c√°c n√∫t 1 ch√∫t */
        header.compact .actions button { padding: 6px 10px; font-size: 13px; }

        /* --------------------
           User Dropdown Styles - ƒê√É TH√äM
           -------------------- */
        .user-avatar-container {
            position: relative;
            display: inline-block;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--blue-dark);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
        }

        .user-avatar:hover {
            border-color: rgba(255,255,255,0.6);
            transform: scale(1.05);
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown .item {
            display: block;
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
            font-size: 14px;
        }

        .dropdown .item:hover {
            background: #f8f9fa;
            color: var(--blue);
        }

        .dropdown .item-name {
            font-weight: bold;
            color: var(--blue);
            border-bottom: 2px solid var(--blue);
        }

        .dropdown .item:last-child {
            border-bottom: none;
        }

        .dropdown form {
            margin: 0;
        }

        /* --------------------
           Navigation
           -------------------- */
        nav { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); margin-top: 0; }

        .nav-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; gap: 24px; padding: 10px 20px; font-weight: 600; }

        /* style cho link categories */
        .nav-inner .nav-link {
            color: #111;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background .18s, color .18s, transform .12s;
            display: inline-flex;
            align-items: center;
        }
        .nav-inner .nav-link:hover {
            background: rgba(37,99,235,0.06);
            color: var(--blue);
            transform: translateY(-2px);
        }
        .nav-inner .nav-link.active {
            color: var(--blue);
            background: rgba(37,99,235,0.12);
            box-shadow: inset 0 -3px 0 rgba(37,99,235,0.08);
        }

        /* --------------------
           Banner & layout
           -------------------- */
        .banner {
            border-radius: 12px;
            text-align: center;
            max-width: 1000px;
            height: 350px;
            background-size: cover;         /* ·∫£nh ph·ªß k√≠n v√πng */
            background-position: center;    /* cƒÉn gi·ªØa ·∫£nh */
            background-repeat: no-repeat;   /* üö´ kh√¥ng l·∫∑p ·∫£nh */
        }

        .products { padding: 20px; text-align: center; max-width: 1200px; margin: 0 auto }
        .section-inner { width: 100%; max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
        .content-inner { display: flex; flex-direction: column; align-items: flex-start; width: max-content; }
        .content-inner h2 { margin-bottom: 8px; text-align: left; }
        .content-inner .sub { color: #666; font-size: 14px; margin-bottom: 14px; text-align: left }

        /* Grid s·∫£n ph·∫©m */
        .grid-featured { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }
        .grid-all { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }

        /* Card */
        .card { background: white; border-radius: 10px; padding: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); transition: 0.25s; width: 100%; }
        .card:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .thumb { height: 140px; border-radius: 8px; background-size: cover; background-position: center; margin-bottom: 10px; }
        .card h3 { font-size: 15px; margin: 6px 0; height: 40px; overflow: hidden; text-align: left }
        .meta { display: flex; gap: 8px; align-items: center; justify-content: space-between; }
        .price { color: #059669; font-weight: 700 }

        /* Buttons: th·ªëng nh·∫•t k√≠ch th∆∞·ªõc */
        .card .action-btn { margin-top: 8px; width: 100%; padding: 12px 14px; border-radius: 8px; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; box-sizing: border-box; transition: all 180ms ease; }

        .card .add-to-cart {
            display: inline-flex; align-items: center; gap: 10px; justify-content: center;
            background: transparent; border: 1.5px solid var(--accent);
            color: var(--accent); font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 180ms ease; box-sizing: border-box; text-decoration: none;
            padding: 12px 14px;
            width: 100%;
        }
        .card .add-to-cart svg { width: 18px; height: 18px; flex-shrink: 0; fill: currentColor;}
        .card .add-to-cart:hover { background: rgba(244,63,94,0.08); transform: translateY(-2px); }

        .card .buy {
            margin-top: 8px;
            width: 100%;
            padding: 12px 14px;
            background: var(--accent);
            color: white;
            border: 1.5px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-sizing: border-box;
            transition: background 160ms ease;
        }
        .card .buy:hover { background: #d6334b; }

        /* highlight text khi t√¨m ki·∫øm */
        .highlight { background: linear-gradient(90deg,#fff9c4,#fff3b0); padding: 0 4px; border-radius: 3px; }

        /* Hi·ªÉn th·ªã khi kh√¥ng c√≥ k·∫øt qu·∫£ t√¨m */
        .no-results { text-align: center; color: #666; padding: 24px; width: 100%; }

        /* toast nh·ªè khi th√™m gi·ªè h√†ng */
        .toast-cart { position: fixed; right: 20px; bottom: 20px; background: #111; color: white; padding: 10px 14px; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); transform: translateY(10px); opacity: 0; transition: all 240ms ease; z-index: 9999; }
        .toast-cart.show { opacity: 1; transform: translateY(0); }

        /* --------------------
           B·ªô l·ªçc s·∫£n ph·∫©m - CSS ƒê√É C·∫¢I THI·ªÜN
           -------------------- */
        .filter-section {
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid var(--gray-200);
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: end;
        }

        .filter-bar {
            flex: 1;
            min-width: 200px;
        }

        .filter-bar label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
        }

        .filter-bar select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--gray-200);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: white;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .filter-bar select:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .filter-form {
            flex: 3;
            min-width: 300px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            margin-bottom: 0;
        }

        .filter-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--gray-200);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: white;
            transition: all 0.2s ease;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .price-range-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .price-range-container input {
            flex: 1;
        }

        .price-range-separator {
            color: var(--gray-600);
            font-weight: 600;
            padding: 0 4px;
        }

        .filter-buttons {
            display: flex;
            gap: 12px;
            margin-top: 0;
            align-items: center;
            height: 100%;
        }

        .filter-buttons button {
            background: var(--blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .filter-buttons button:hover {
            background: var(--blue-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .filter-buttons a {
            padding: 10px 16px;
            background: var(--gray-200);
            color: var(--gray-800);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .filter-buttons a:hover {
            background: var(--gray-600);
            color: white;
            transform: translateY(-1px);
        }

        /* --------------------
           Pagination styles
           -------------------- */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
        .page-btn, .page-num {
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid rgba(0,0,0,0.06);
            box-sizing: border-box;
            display: inline-block;
        }
        .page-btn {
            background: white;
            color: #111;
        }
        .page-num {
            background: white;
            color: #111;
        }
        .page-num.active {
            background: var(--blue);
            color: white;
            border-color: rgba(0,0,0,0.06);
        }
        .page-num:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(16,24,40,0.06); }

        /* --------------------
           Toast Animations - ƒê√É TH√äM
           -------------------- */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast-success, .toast-error {
            animation: slideInRight 0.5s ease-out;
        }

        .toast-success.hiding, .toast-error.hiding {
            animation: slideOutRight 0.5s ease-in forwards;
        }

        /* Progress bar for auto-hide */
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 0 0 12px 12px;
            animation: progressBar 3s linear forwards;
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        /* Responsive: r√∫t g·ªçn layout header cho mobile */
        @media (max-width: 880px) {
            .header-inner { padding: 0 12px; gap: 10px; }
            .search-box { display: none; } /* ·∫©n search tr√™n mobile header ƒë·ªÉ g·ªçn (t√πy b·∫°n) */
            .nav-inner { padding: 8px 12px; gap: 12px; overflow-x:auto; }
            .grid-featured, .grid-all { grid-template-columns: repeat(2, 1fr); }

            /* Responsive cho b·ªô l·ªçc */
            .filter-container {
                flex-direction: column;
                gap: 16px;
            }

            .filter-bar, .filter-form {
                width: 100%;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .filter-buttons {
                justify-content: stretch;
            }

            .filter-buttons button,
            .filter-buttons a {
                flex: 1;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .filter-section {
                padding: 16px;
            }

            .price-range-container {
                flex-direction: column;
                gap: 8px;
            }

            .price-range-separator {
                display: none;
            }
        }
    </style>
</head>

<body>
<!-- üéâ Toast Notification Container -->
<div id="notificationContainer"
     style="position: fixed; top: 100px; right: 20px; z-index: 9999; max-width: 400px;">

    <!-- Success Notification -->
    <div th:if="${showPaymentSuccess}"
         id="successToast"
         class="toast-success"
         style="background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 12px;
                animation: slideInRight 0.5s ease-out;
                border-left: 4px solid #047857;">

        <!-- Icon -->
        <div style="flex-shrink: 0;
                    width: 24px;
                    height: 24px;
                    background: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </div>

        <!-- Content -->
        <div style="flex: 1;">
            <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">
                üéâ Thanh to√°n th√†nh c√¥ng!
            </div>
            <div style="font-size: 14px; opacity: 0.9;">
                ƒê∆°n h√†ng <strong th:text="${successOrderCode}">ORD-XXXX</strong> ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω.
                License keys ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.
            </div>
        </div>

        <!-- Close Button -->
        <button onclick="this.parentElement.remove()"
                style="background: none;
                       border: none;
                       color: white;
                       cursor: pointer;
                       padding: 4px;
                       border-radius: 4px;
                       opacity: 0.8;
                       transition: opacity 0.2s;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <!-- Error Notification -->
    <div th:if="${showPaymentError}"
         id="errorToast"
         class="toast-error"
         style="background: linear-gradient(135deg, #ef4444, #dc2626);
                color: white;
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 12px;
                animation: slideInRight 0.5s ease-out;
                border-left: 4px solid #b91c1c;">

        <!-- Icon -->
        <div style="flex-shrink: 0;
                    width: 24px;
                    height: 24px;
                    background: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="3">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </div>

        <!-- Content -->
        <div style="flex: 1;">
            <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">
                ‚ùå Thanh to√°n th·∫•t b·∫°i
            </div>
            <div style="font-size: 14px; opacity: 0.9;"
                 th:text="${paymentErrorMessage}">
                C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω thanh to√°n.
            </div>
        </div>

        <!-- Close Button -->
        <button onclick="this.parentElement.remove()"
                style="background: none;
                       border: none;
                       color: white;
                       cursor: pointer;
                       padding: 4px;
                       border-radius: 4px;
                       opacity: 0.8;
                       transition: opacity 0.2s;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
</div>

<header id="siteHeader">
    <div class="header-inner">
        <h1>License Shop</h1>

        <div class="search-box" aria-hidden="false">
            <div class="search-controls" role="search" aria-label="T√¨m s·∫£n ph·∫©m">
                <input id="searchInput" type="text" placeholder="T√¨m s·∫£n ph·∫©m theo t√™n, t·ª´ kho√°..." aria-label="T√¨m s·∫£n ph·∫©m"/>
                <button id="clearSearch" class="search-clear hidden" aria-label="X√≥a t√¨m ki·∫øm">X</button>
            </div>
        </div>

        <!-- Actions (theo th·ª© t·ª±: Tr·ª£ l√Ω ·∫£o, Gi·ªè h√†ng, H·ªó tr·ª£, Profile/ƒêƒÉng nh·∫≠p) -->
        <div class="actions" role="group" aria-label="H√†nh ƒë·ªông ng∆∞·ªùi d√πng">

            <!-- Auth (khi ch∆∞a ƒëƒÉng nh·∫≠p) -->
            <div th:if="${customer == null}" style="display:inline-flex; gap:8px; align-items:center;">
                <!-- ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
                <a th:href="@{/login.html}" class="auth-login" role="button">ƒêƒÉng nh·∫≠p</a>
                <a th:href="@{/register.html}" class="auth-register" role="button">ƒêƒÉng k√Ω</a>
            </div>

            <!-- User menu khi ƒë√£ ƒëƒÉng nh·∫≠p -->
            <div class="user-menu" th:if="${customer != null}" style="display:inline-flex; gap:8px; align-items:center;">
                <!-- Tr·ª£ l√Ω ·∫£o (ch·ªâ sau ƒëƒÉng nh·∫≠p) -->
                <a th:href="@{/chat}" class="assistant-btn" role="button" aria-label="Tr·ª£ l√Ω ·∫£o">
                    Tr·ª£ l√Ω ·∫£o
                </a>

                <!-- Gi·ªè h√†ng (ch·ªâ sau ƒëƒÉng nh·∫≠p) -->
                <a th:href="@{/cart/view}" class="cart-btn" role="button" aria-label="Gi·ªè h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42l.72-1.55L17 7H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                    </svg>
                    <span class="cart-text">Gi·ªè h√†ng</span>
                </a>

                <!-- H·ªó tr·ª£ kh√°ch h√†ng (ch·ªâ sau ƒëƒÉng nh·∫≠p) -->
                <a th:href="@{/support/view}" class="support-btn" role="button" aria-label="H·ªó tr·ª£ kh√°ch h√†ng">
                    <span>H·ªó tr·ª£</span>
                </a>

                <!-- Avatar / profile v·ªõi dropdown wrapper -->
                <div class="user-avatar-container">
                    <div id="userAvatar" class="user-avatar" title="T√†i kho·∫£n">
                        <img th:if="${customer.avatar != null}"
                             th:src="@{'/customer/avatar/' + ${customer.id}}" alt="avatar" class="avatar-img"/>
                        <span th:if="${customer.avatar == null}"
                              th:text="${#strings.substring(customer.name,0,1).toUpperCase()}">U</span>
                    </div>

                    <div id="userDropdown" class="dropdown" aria-hidden="true">
                        <div class="item item-name" th:text="${customer.name}">T√™n user</div>
                        <a th:href="@{/customer/profile}" class="item">Profile</a>
                        <a th:href="@{/purchasedlicenses}" class="item">Purchased License</a>
                        <a th:href="@{/home/my-reported-reviews}" class="item">My Reported Reviews</a>
                        <form th:action="@{/auth/customer/logout}" method="post" style="margin:0;">
                            <button type="submit" class="item" style="width:100%;background:none;border:none;text-align:left;cursor:pointer;">
                                Log out
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<nav style="margin-top:0;">
    <div class="nav-inner" id="mainNav">
        <!-- Hard-coded links mapped to category IDs you specified:
             1 = H·ªçc t·∫≠p, 2 = Gi·∫£i tr√≠, 3 = L√†m vi·ªác, 4 = Windows, 5 = VPN -->
        <a class="nav-link" th:href="@{/home/homepage}">ALL</a>
        <a class="nav-link" th:href="@{/home/category/2}"
           th:classappend="${currentCategory != null and currentCategory.id == 2} ? ' active' : ''">Gi·∫£i tr√≠</a>

        <a class="nav-link" th:href="@{/home/category/3}"
           th:classappend="${currentCategory != null and currentCategory.id == 3} ? ' active' : ''">L√†m vi·ªác</a>

        <a class="nav-link" th:href="@{/home/category/1}"
           th:classappend="${currentCategory != null and currentCategory.id == 1} ? ' active' : ''">H·ªçc t·∫≠p</a>

        <a class="nav-link" th:href="@{/home/category/4}"
           th:classappend="${currentCategory != null and currentCategory.id == 4} ? ' active' : ''">Windows</a>

        <a class="nav-link" th:href="@{/home/category/5}"
           th:classappend="${currentCategory != null and currentCategory.id == 5} ? ' active' : ''">VPN</a>
    </div>
</nav>

<!-- Th√™m 1 spacer ·ªü tr√™n n·ªôi dung: s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS ƒë·ªÉ tr√°nh nh·∫£y -->
<main id="pageContent" style="margin-top:0;">
    <div style="height: 8px;"></div>

    <div class="banner" style="background-image: url('https://scontent.fhan14-1.fna.fbcdn.net/v/t1.15752-9/582426735_843664641352653_6255392200947647626_n.png?stp=dst-png_s720x720&_nc_cat=107&ccb=1-7&_nc_sid=0024fc&_nc_eui2=AeFNHCCKVNoRMcQPNZDaIxnlBN5edadTvYQE3l51p1O9hE-zn_OI8UhJ2yIgDg_D0Kwnj-TtuOiq7XbD4OVhHjNt&_nc_ohc=zmkzig7SOiUQ7kNvwE-JxkT&_nc_oc=Adk6iZXE2itMhjghfp92yHpF5YUBl-WKDGJoCaFwn7RvSr7nJpYy_WvBMkvnhkxLYhw&_nc_ad=z-m&_nc_cid=0&_nc_zt=23&_nc_ht=scontent.fhan14-1.fna&oh=03_Q7cD3wFyEhv4nUhoq-RT9GfWOYQwdM2cXocd4x73jOj0VTtMwA&oe=693A1531');">
    </div>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
                <div class="sub">Danh s√°ch nh·ªØng s·∫£n ph·∫©m ƒë∆∞·ª£c mua nhi·ªÅu nh·∫•t</div>

                <div class="grid-featured">
                    <div th:each="product : ${bestSellers}" class="card">
                        <div class="thumb" th:style="|background-image: url('${product.img_url}')|"></div>
                        <h3 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h3>
                        <div class="meta">
                        <span class="price"
                              th:text="${#lists.isEmpty(product.variants) ? 'Li√™n h·ªá' : product.variants[0].price + ' ƒë'}">Gi√°</span>
                        </div>
                        <div class="actions-row">
                            <button
                                    class="add-to-cart action-btn"
                                    type="button"
                                    th:attr="data-product-id=${product.id}"
                                    aria-label="Th√™m v√†o gi·ªè h√†ng"
                                    th:onclick="|window.location.href='/product/${product.id}?from=addcart'|">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42c-.14 0-.25-.11-.25-.25l.03-.12L15.1 9H20V7h-5.21l-.94-2H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                Th√™m V√†o Gi·ªè H√†ng
                            </button>

                            <button
                                    class="buy action-btn"
                                    type="button"
                                    aria-label="Mua ngay"
                                    th:onclick="|window.location.href='@{/buydetail/{id}(id=${product.id})}'|">
                                Mua ngay
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <!-- B·ªô l·ªçc s·∫£n ph·∫©m - ƒê√É C·∫¢I THI·ªÜN -->
                <div class="filter-section">
                    <div class="filter-container">
                        <!-- Thanh danh m·ª•c (b√™n tr√°i) -->
                        <div class="filter-bar" aria-label="Ch·ªçn danh m·ª•c">
                            <label for="categorySelect">Danh m·ª•c</label>
                            <select id="categorySelect" onchange="if(this.value) location.href=this.value;">
                                <option th:value="@{/home/homepage}" th:selected="${currentCategory == null}">T·∫•t c·∫£</option>
                                <option th:each="cat : ${categories}"
                                        th:value="@{/home/category/{id}(id=${cat.id})}"
                                        th:text="${cat.name}"
                                        th:selected="${currentCategory != null and currentCategory.id == cat.id}">
                                </option>
                            </select>
                        </div>

                        <!-- Form l·ªçc (b√™n ph·∫£i, chi·∫øm di·ªán t√≠ch c√≤n l·∫°i) -->
                        <form th:action="${currentCategory != null} ? @{/home/category/{id}(id=${currentCategory.id})} : @{/home/homepage}"
                              method="get"
                              class="filter-form">

                            <!-- Gi·ªØ l·∫°i category v√† page parameters -->
                            <input type="hidden" name="page" value="0">

                            <div class="filter-grid">
                                <!-- T√¨m ki·∫øm theo t√™n -->
                                <div class="filter-group">
                                    <label for="search">T√¨m ki·∫øm</label>
                                    <input type="text"
                                           id="search"
                                           name="search"
                                           th:value="${search}"
                                           placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m...">
                                </div>

                                <!-- Kho·∫£ng gi√° -->
                                <div class="filter-group">
                                    <label>Kho·∫£ng gi√°</label>
                                    <div class="price-range-container">
                                        <input type="number"
                                               name="minPrice"
                                               th:value="${minPrice}"
                                               placeholder="Gi√° th·∫•p nh·∫•t">
                                        <span class="price-range-separator">-</span>
                                        <input type="number"
                                               name="maxPrice"
                                               th:value="${maxPrice}"
                                               placeholder="Gi√° cao nh·∫•t">
                                    </div>
                                </div>

                                <!-- S·∫Øp x·∫øp -->
                                <div class="filter-group">
                                    <label for="sort">S·∫Øp x·∫øp</label>
                                    <select id="sort" name="sort" th:value="${sort}">
                                        <option value="">M·∫∑c ƒë·ªãnh</option>
                                        <option value="name_asc" th:selected="${sort == 'name_asc'}">T√™n A-Z</option>
                                        <option value="name_desc" th:selected="${sort == 'name_desc'}">T√™n Z-A</option>
                                    </select>
                                </div>

                                <!-- N√∫t l·ªçc -->
                                <div class="filter-group">
                                    <div class="filter-buttons">
                                        <button type="submit">L·ªçc</button>
                                        <a th:href="${currentCategory != null} ? @{/home/category/{id}(id=${currentCategory.id})} : @{/home/homepage}">
                                            X√≥a l·ªçc
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <h2>T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
                <div class="sub">Danh s√°ch ƒë·∫ßy ƒë·ªß s·∫£n ph·∫©m</div>

                <div class="grid-all" id="allGrid">
                    <!-- Thymeleaf render .card ·ªü ƒë√¢y -->
                    <div th:each="product : ${products}" class="card">
                        <div class="thumb" th:style="|background-image: url('${product.img_url}')|"></div>
                        <h3 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h3>
                        <div class="meta">
                            <span class="price"
                                  th:text="${#lists.isEmpty(product.variants) ? 'Li√™n h·ªá' : product.variants[0].price + ' ƒë'}">Gi√°</span>
                        </div>
                        <div class="actions-row">
                            <button
                                    class="add-to-cart action-btn"
                                    type="button"
                                    th:attr="data-product-id=${product.id}"
                                    aria-label="Th√™m v√†o gi·ªè h√†ng"
                                    th:onclick="|window.location.href='/product/${product.id}?from=addcart'|">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42c-.14 0-.25-.11-.25-.25l.03-.12L15.1 9H20V7h-5.21l-.94-2H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                Th√™m V√†o Gi·ªè H√†ng
                            </button>
                            <button class="buy action-btn"
                                    type="button"
                                    th:onclick="|window.location.href='/buydetail/${product.id}'|"
                                    aria-label="Mua ngay">
                                Mua ngay
                            </button>

                        </div>
                    </div>
                </div>

                <div id="noResults" class="no-results" style="display:none;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o kh·ªõp.</div>

                <!-- ======== Pagination ƒê√É S·ª¨A L·ªñI ======== -->
                <div th:if="${totalPages != null and totalPages > 1}" class="pagination" role="navigation" aria-label="Ph√¢n trang s·∫£n ph·∫©m">
                    <!-- Prev -->
                    <a th:if="${hasPrev}"
                       th:href="${currentCategory != null} ?
                                @{/home/category/{id}(id=${currentCategory.id}, page=${currentPage - 1}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})} :
                                @{/home/homepage(page=${currentPage - 1}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})}"
                       class="page-btn">‚Üê Tr∆∞·ªõc</a>

                    <!-- Pages (hi·ªÉn th·ªã 1-based cho ng∆∞·ªùi d√πng, model d√πng 0-based) -->
                    <span th:each="p : ${#numbers.sequence(0, totalPages - 1)}">
                        <a th:classappend="${p == currentPage} ? ' page-num active' : ' page-num'"
                           th:href="${currentCategory != null} ?
                                    @{/home/category/{id}(id=${currentCategory.id}, page=${p}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})} :
                                    @{/home/homepage(page=${p}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})}"
                           th:text="${p + 1}">1</a>
                    </span>

                    <!-- Next -->
                    <a th:if="${hasNext}"
                       th:href="${currentCategory != null} ?
                                @{/home/category/{id}(id=${currentCategory.id}, page=${currentPage + 1}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})} :
                                @{/home/homepage(page=${currentPage + 1}, search=${search}, minPrice=${minPrice}, maxPrice=${maxPrice}, sort=${sort})}"
                       class="page-btn">Ti·∫øp ‚Üí</a>
                </div>
                <!-- ======== end pagination ======== -->

            </div>
        </div>
    </section>
</main>

<script>
    // Search input clear button behavior
    document.addEventListener('DOMContentLoaded', function() {
        const avatar = document.getElementById('userAvatar');
        const dropdown = document.getElementById('userDropdown');

        if (avatar && dropdown) {
            avatar.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
                dropdown.setAttribute('aria-hidden', dropdown.classList.contains('show') ? 'false' : 'true');
            });

            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && !avatar.contains(e.target)) {
                    dropdown.classList.remove('show');
                    dropdown.setAttribute('aria-hidden', 'true');
                }
            });
        }

        // search clear button
        const input = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearSearch');
        if (input && clearBtn) {
            input.addEventListener('input', function() {
                if (input.value && input.value.trim().length > 0) {
                    clearBtn.classList.remove('hidden');
                } else {
                    clearBtn.classList.add('hidden');
                }
            });
            clearBtn.addEventListener('click', function() {
                input.value = '';
                clearBtn.classList.add('hidden');
            });
        }

        // üéâ Toast Notification Auto-hide
        const successToast = document.getElementById('successToast');
        const errorToast = document.getElementById('errorToast');

        function autoHideToast(toastElement) {
            if (toastElement) {
                // Add progress bar
                const progressBar = document.createElement('div');
                progressBar.className = 'toast-progress';
                toastElement.style.position = 'relative';
                toastElement.appendChild(progressBar);

                // Auto hide after 3 seconds
                setTimeout(() => {
                    toastElement.classList.add('hiding');
                    setTimeout(() => {
                        if (toastElement.parentElement) {
                            toastElement.parentElement.removeChild(toastElement);
                        }
                    }, 500);
                }, 3000);
            }
        }

        // Apply to both success and error toasts
        autoHideToast(successToast);
        autoHideToast(errorToast);

        // Also handle manual close with smooth animation
        document.querySelectorAll('#notificationContainer button').forEach(button => {
            button.addEventListener('click', function() {
                const toast = this.closest('.toast-success, .toast-error');
                if (toast) {
                    toast.classList.add('hiding');
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.parentElement.removeChild(toast);
                        }
                    }, 500);
                }
            });
        });
    });
</script>

</body>
</html>