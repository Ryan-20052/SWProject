<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Shop</title>
    <link rel="stylesheet" href="/homepage.css" th:href="@{/homepage.css}" />
    <script src="/homepage.js"></script>
    <style>
        /* --------------------
           Bi·∫øn m√†u ch√≠nh
           -------------------- */
        :root {
            --blue: #2563eb;
            --blue-dark: #1d4ed8;
            --blue-light: rgba(37,99,235,0.15); /* Light blue for button backgrounds */
            --accent: #f43f5e; /* m√†u ƒë·ªè/ƒë·∫≠m cho n√∫t th√™m gi·ªè */
            --white-90: rgba(255,255,255,0.9);
        }

        /* --------------------
           Reset & body
           -------------------- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f8f9fa;
            color: #111;
            transition: padding-top 160ms ease;
        }

        /* --------------------
           Header (fixed) & search
           -------------------- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--blue);
            color: white;
            padding: 15px 20px;
            display: block;
            transition: all 0.28s cubic-bezier(.2,.9,.2,1);
            z-index: 1200;
            will-change: padding, box-shadow, backdrop-filter;
            backdrop-filter: blur(0px);
        }

        /* compact state khi scroll */
        header.compact {
            box-shadow: 0 4px 18px rgba(16,24,40,0.12);
            backdrop-filter: blur(4px);
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        header h1 {
            font-size: 20px;
            margin: 0;
            white-space: nowrap;
            transition: transform 0.28s, font-size 0.28s;
        }

        /* Khi compact, thu nh·ªè ti√™u ƒë·ªÅ 1 ch√∫t */
        header.compact .header-inner h1 {
            transform: translateY(-1px);
            font-size: 16px;
        }

        /* search box ch·ª©a input + clear */
        .search-box { flex: 1; display: flex; justify-content: center; }
        .search-controls { display: flex; gap: 8px; align-items: center; width: 100%; max-width: 600px; }
        .search-controls input {
            flex: 1;
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            outline: none;
            box-sizing: border-box;
            transition: padding 0.2s, font-size 0.2s;
        }
        header.compact .search-controls input {
            padding: 8px 10px;
            font-size: 13px;
        }
        .search-clear {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        .search-clear.hidden { display: none; opacity: 0; }

        /* Actions (Login/Register/Cart/Support/Assistant) */
        .actions { display: flex; gap: 8px; align-items: center; }

        /* Reset chung cho c√°c n√∫t trong header (tr·ª´ user-avatar) */
        .actions button, .actions a:not(.user-avatar) {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-sizing: border-box;
            transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease, color 140ms ease;
            white-space: nowrap;
            text-decoration: none;
            color: white;
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
        }

        /* N√∫t Tr·ª£ l√Ω ·∫£o */
        .assistant-btn {
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
            color: var(--white-90);
        }
        .assistant-btn:hover {
            background: #2d89ef;
            border-color: #2d89ef;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37,99,235,0.2);
        }

        /* N√∫t ƒêƒÉng nh·∫≠p */
        .auth-login {
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
            color: var(--white-90);
        }
        .auth-login:hover {
            background: #2d89ef;
            border-color: #2d89ef;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37,99,235,0.2);
        }

        /* N√∫t ƒêƒÉng k√Ω */
        .auth-register {
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
            color: var(--white-90);
            font-weight: 600;
        }
        .auth-register:hover {
            background: #2d89ef;
            border-color: #2d89ef;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37,99,235,0.2);
        }

        /* N√∫t Gi·ªè h√†ng */
        .cart-btn {
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
            color: var(--white-90);
        }
        .cart-btn:hover {
            background: #2d89ef;
            border-color:#2d89ef;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37,99,235,0.2);
        }

        /* N√∫t H·ªó tr·ª£ */
        .support-btn {
            background: var(--blue-light);
            border: 1.5px solid var(--white-90);
            color: var(--white-90);
        }
        .support-btn:hover {
            background: #2d89ef;
            border-color: #2d89ef;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37,99,235,0.2);
        }

        /* Khi header compact, gi·∫£m k√≠ch th∆∞·ªõc c√°c n√∫t */
        header.compact .actions button, header.compact .actions a:not(.user-avatar) {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* --------------------
           Navigation
           -------------------- */
        nav { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); margin-top: 0; }

        .nav-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; gap: 24px; padding: 10px 20px; font-weight: 600; }

        /* style cho link categories */
        .nav-inner .nav-link {
            color: #111;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background .18s, color .18s, transform .12s;
            display: inline-flex;
            align-items: center;
        }
        .nav-inner .nav-link:hover {
            background: rgba(37,99,235,0.06);
            color: #2d89ef;
            transform: translateY(-2px);
        }
        .nav-inner .nav-link.active {
            color: #2d89ef;
            background: rgba(37,99,235,0.12);
            box-shadow: inset 0 -3px 0 rgba(37,99,235,0.08);
        }

        /* --------------------
           Banner & layout
           -------------------- */
        .banner {
            border-radius: 12px;
            text-align: center;
            max-width: 1000px;
            height: 350px;
            background-size: cover;         /* ·∫£nh ph·ªß k√≠n v√πng */
            background-position: center;    /* cƒÉn gi·ªØa ·∫£nh */
            background-repeat: no-repeat;   /* üö´ kh√¥ng l·∫∑p ·∫£nh */
        }

        .products { padding: 20px; text-align: center; max-width: 1200px; margin: 0 auto }
        .section-inner { width: 100%; max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
        .content-inner { display: flex; flex-direction: column; align-items: flex-start; width: max-content; }
        .content-inner h2 { margin-bottom: 8px; text-align: left; }
        .content-inner .sub { color: #666; font-size: 14px; margin-bottom: 14px; text-align: left }

        /* Grid s·∫£n ph·∫©m */
        .grid-featured { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }
        .grid-all { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }

        /* Card */
        .card { background: white; border-radius: 10px; padding: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); transition: 0.25s; width: 100%; }
        .card:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .thumb { height: 140px; border-radius: 8px; background-size: cover; background-position: center; margin-bottom: 10px; }
        .card h3 { font-size: 15px; margin: 6px 0; height: 40px; overflow: hidden; text-align: left }
        .meta { display: flex; gap: 8px; align-items: center; justify-content: space-between; }
        .price { color: #059669; font-weight: 700 }

        /* Buttons: th·ªëng nh·∫•t k√≠ch th∆∞·ªõc */
        .card .action-btn { margin-top: 8px; width: 100%; padding: 12px 14px; border-radius: 8px; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; box-sizing: border-box; transition: all 180ms ease; }

        .card .add-to-cart {
            display: inline-flex; align-items: center; gap: 10px; justify-content: center;
            background: transparent; border: 1.5px solid var(--accent);
            color: var(--accent); font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 180ms ease; box-sizing: border-box; text-decoration: none;
            padding: 12px 14px;
            width: 100%;
        }
        .card .add-to-cart svg { width: 18px; height: 18px; flex-shrink: 0; fill: currentColor; }
        .card .add-to-cart:hover { background: rgba(244,63,94,0.08); transform: translateY(-2px); }

        .card .buy {
            margin-top: 8px;
            width: 100%;
            padding: 12px 14px;
            background: var(--accent);
            color: white;
            border: 1.5px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-sizing: border-box;
            transition: background 160ms ease;
        }
        .card .buy:hover { background: #d6334b; }

        /* highlight text khi t√¨m ki·∫øm */
        .highlight { background: linear-gradient(90deg,#fff9c4,#fff3b0); padding: 0 4px; border-radius: 3px; }

        /* Hi·ªÉn th·ªã khi kh√¥ng c√≥ k·∫øt qu·∫£ t√¨m */
        .no-results { text-align: center; color: #666; padding: 24px; width: 100%; }

        /* toast nh·ªè khi th√™m gi·ªè h√†ng */
        .toast-cart { position: fixed; right: 20px; bottom: 20px; background: #111; color: white; padding: 10px 14px; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); transform: translateY(10px); opacity: 0; transition: all 240ms ease; z-index: 9999; }
        .toast-cart.show { opacity: 1; transform: translateY(0); }

        /* --------------------
           Pagination styles
           -------------------- */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
        .page-btn, .page-num {
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid rgba(0,0,0,0.06);
            box-sizing: border-box;
            display: inline-block;
        }
        .page-btn {
            background: white;
            color: #111;
        }
        .page-num {
            background: white;
            color: #111;
        }
        .page-num.active {
            background: var(--blue);
            color: white;
            border-color: rgba(0,0,0,0.06);
        }
        .page-num:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(16,24,40,0.06); }

        /* Responsive: r√∫t g·ªçn layout header cho mobile */
        @media (max-width: 880px) {
            .header-inner { padding: 0 12px; gap: 10px; }
            .search-box { display: none; } /* ·∫©n search tr√™n mobile header ƒë·ªÉ g·ªçn */
            .nav-inner { padding: 8px 12px; gap: 12px; overflow-x:auto; }
            .grid-featured, .grid-all { grid-template-columns: repeat(2, 1fr); }
            .page-num { padding: 6px 8px; font-size: 14px; }
        }

        /* Simple dropdown */
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.12); color: white; display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; }
        .avatar-img { width:100%; height:100%; object-fit:cover; border-radius:50%; display:block; }
        .dropdown { position: absolute; right: 20px; top: 68px; background: white; color: #111; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.12); min-width:180px; display:none; z-index:1300; }
        .dropdown.show { display:block; }
        .dropdown .item { padding:10px 12px; display:block; text-decoration:none; color:inherit; border-bottom:1px solid rgba(0,0,0,0.04); }
        .dropdown .item:last-child { border-bottom:none; }
        .dropdown .item:hover { background: rgba(0,0,0,0.02); }

    </style>
</head>
<script>
    // N·∫øu b·∫°n ƒë√£ c√≥ homepage.js, h√†m n√†y c√≥ th·ªÉ n·∫±m ·ªü ƒë√≥. ƒê√¢y l√† fallback/ti·ªán l·ª£i.
    function loadCart() {
        try {
            const raw = localStorage.getItem('cart');
            if (!raw) return [];
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed)) return parsed;
            return [];
        } catch (e) {
            return [];
        }
    }
</script>

<body>
<header id="siteHeader">
    <div class="header-inner">
        <h1>License Shop</h1>

        <div class="search-box" aria-hidden="false">
            <div class="search-controls" role="search" aria-label="T√¨m s·∫£n ph·∫©m">
                <input id="searchInput" type="text" placeholder="T√¨m s·∫£n ph·∫©m theo t√™n, t·ª´ kho√°..." aria-label="T√¨m s·∫£n ph·∫©m"/>
                <button id="clearSearch" class="search-clear hidden" aria-label="X√≥a t√¨m ki·∫øm">X</button>
            </div>
        </div>

        <!-- Actions (theo th·ª© t·ª±: Tr·ª£ l√Ω ·∫£o, Gi·ªè h√†ng, H·ªó tr·ª£, Profile/ƒêƒÉng nh·∫≠p) -->
        <div class="actions" role="group" aria-label="H√†nh ƒë·ªông ng∆∞·ªùi d√πng">

            <!-- Tr·ª£ l√Ω ·∫£o (lu√¥n hi·ªÉn th·ªã) -->
            <a th:href="@{/chat}" class="assistant-btn" role="button" aria-label="Tr·ª£ l√Ω ·∫£o">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16zm-1-5h2v2h-2zm0-8h2v6h-2z"/>
                </svg>
                Tr·ª£ l√Ω ·∫£o
            </a>

            <!-- Gi·ªè h√†ng + Support + Auth (khi ch∆∞a ƒëƒÉng nh·∫≠p) -->
            <div th:if="${customer == null}" style="display:inline-flex; gap:8px; align-items:center;">
                <!-- Gi·ªè h√†ng (guest) - d√πng class chung .cart-btn ƒë·ªÉ JS c·∫≠p nh·∫≠t -->
                <a th:href="@{/cart/view}" class="cart-btn" role="button" aria-label="Gi·ªè h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42l.72-1.55L17 7H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                    </svg>
                    <span class="cart-text">Gi·ªè h√†ng (0)</span>
                </a>

                <!-- H·ªó tr·ª£ kh√°ch h√†ng -->
                <a th:href="@{/support/view}" class="support-btn" role="button" aria-label="H·ªó tr·ª£ kh√°ch h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 15h-2v-2h2v2zm1.07-7.75l-.9.92A2.5 2.5 0 0012.5 12H11v-1h1.5c.28 0 .5-.22.5-.5 0-.13-.05-.26-.15-.35L11.9 7.9A1 1 0 0113 7c.55 0 1 .45 1 1 0 .28-.11.53-.28.75z"/>
                    </svg>
                    <span>H·ªó tr·ª£</span>
                </a>

                <!-- ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
                <a th:href="@{/login.html}" class="auth-login" role="button">ƒêƒÉng nh·∫≠p</a>
                <a th:href="@{/register.html}" class="auth-register" role="button">ƒêƒÉng k√Ω</a>
            </div>

            <!-- User menu khi ƒë√£ ƒëƒÉng nh·∫≠p -->
            <div class="user-menu" th:if="${customer != null}" style="display:inline-flex; gap:8px; align-items:center;">
                <!-- Gi·ªè h√†ng (user) -->
                <a th:href="@{/cart/view}" class="cart-btn" role="button" aria-label="Gi·ªè h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42l.72-1.55L17 7H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                    </svg>
                    <span class="cart-text">Gi·ªè h√†ng (0)</span>
                </a>

                <!-- H·ªó tr·ª£ kh√°ch h√†ng (user) -->
                <a th:href="@{/support/view}" class="support-btn" role="button" aria-label="H·ªó tr·ª£ kh√°ch h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 15h-2v-2h2v2zm1.07-7.75l-.9.92A2.5 2.5 0 0012.5 12H11v-1h1.5c.28 0 .5-.22.5-.5 0-.13-.05-.26-.15-.35L11.9 7.9A1 1 0 0113 7c.55 0 1 .45 1 1 0 .28-.11.53-.28.75z"/>
                    </svg>
                    <span>H·ªó tr·ª£</span>
                </a>

                <!-- Avatar / profile (gi·ªØ nguy√™n dropdown c·ªßa b·∫°n) -->
                <div id="userAvatar" class="user-avatar" title="T√†i kho·∫£n" style="cursor:pointer;">
                    <img th:if="${customer.avatar != null}"
                         th:src="@{'/customer/avatar/' + ${customer.id}}" alt="avatar" class="avatar-img"/>
                    <span th:if="${customer.avatar == null}"
                          th:text="${#strings.substring(customer.name,0,1).toUpperCase()}">U</span>
                </div>

                <div id="userDropdown" class="dropdown" aria-hidden="true">
                    <div class="item item-name" th:text="${customer.name}">T√™n user</div>
                    <a th:href="@{/customer/profile}" class="item">Profile</a>
                    <a th:href="@{/purchasedlicenses}" class="item">Purchased License</a>
                    <form th:action="@{/auth/customer/logout}" method="post" style="margin:0;">
                        <button type="submit" class="item" style="width:100%;background:none;border:none;text-align:left;cursor:pointer;">
                            Log out
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</header>

<nav style="margin-top:0;">
    <div class="nav-inner" id="mainNav">
        <!-- Hard-coded links mapped to category IDs you specified:
             1 = H·ªçc t·∫≠p, 2 = Gi·∫£i tr√≠, 3 = L√†m vi·ªác, 4 = Windows, 5 = VPN -->
        <a class="nav-link" th:href="@{/home/homepage}">ALL</a>
        <a class="nav-link" th:href="@{/home/category/2}"
           th:classappend="${currentCategory != null and currentCategory.id == 2} ? ' active' : ''">Gi·∫£i tr√≠</a>

        <a class="nav-link" th:href="@{/home/category/3}"
           th:classappend="${currentCategory != null and currentCategory.id == 3} ? ' active' : ''">L√†m vi·ªác</a>

        <a class="nav-link" th:href="@{/home/category/1}"
           th:classappend="${currentCategory != null and currentCategory.id == 1} ? ' active' : ''">H·ªçc t·∫≠p</a>

        <a class="nav-link" th:href="@{/home/category/4}"
           th:classappend="${currentCategory != null and currentCategory.id == 4} ? ' active' : ''">Windows</a>

        <a class="nav-link" th:href="@{/home/category/5}"
           th:classappend="${currentCategory != null and currentCategory.id == 5} ? ' active' : ''">VPN</a>
    </div>
</nav>

<!-- Th√™m 1 spacer ·ªü tr√™n n·ªôi dung: s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS ƒë·ªÉ tr√°nh nh·∫£y -->
<main id="pageContent" style="margin-top:0;">
    <div style="height: 8px;"></div>

    <div class="banner" style="background-image: url('https://scontent.fhan14-1.fna.fbcdn.net/v/t1.15752-9/554418352_770267042671107_6961607438473419344_n.png?stp=dst-png_s720x720&_nc_cat=105&ccb=1-7&_nc_sid=0024fc&_nc_eui2=AeHyEG88V0DdnLVBMkWAgYkvokjCGs1qhreiSMIazWqGt9gSNYfky-rFMwsRQ9xtFUnBikEQnwSPNDujEYFs-Zzz&_nc_ohc=imsD9FHbcRkQ7kNvwGKjasb&_nc_oc=AdkJmZJingJ-oIouY3Tr1huLHpiI3L8kQ6tyNoFyga7bCbG7JQqE3Rr8fCdci8I8U4A&_nc_ad=z-m&_nc_cid=0&_nc_zt=23&_nc_ht=scontent.fhan14-1.fna&oh=03_Q7cD3gGI69ff7TPgpqGRnbvjHTFf9CyXp0VzWHHYl3GFS7n3Rw&oe=690B3783');">
    </div>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
                <div class="sub">Danh s√°ch nh·ªØng s·∫£n ph·∫©m ƒë∆∞·ª£c mua nhi·ªÅu nh·∫•t</div>

                <div class="grid-featured">
                    <div th:each="product : ${bestSellers}" class="card">
                        <div class="thumb" th:style="|background-image: url('${product.img_url}')|"></div>
                        <h3 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h3>
                        <div class="meta">
                        <span class="price"
                              th:text="${#lists.isEmpty(product.variants) ? 'Li√™n h·ªá' : product.variants[0].price + ' ƒë'}">Gi√°</span>
                        </div>
                        <div class="actions-row">
                            <button
                                    class="add-to-cart action-btn"
                                    type="button"
                                    th:attr="data-product-id=${product.id}"
                                    aria-label="Th√™m v√†o gi·ªè h√†ng"
                                    th:onclick="|window.location.href='/product/${product.id}?from=addcart'|">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42c-.14 0-.25-.11-.25-.25l.03-.12L15.1 9H20V7h-5.21l-.94-2H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                Th√™m V√†o Gi·ªè H√†ng
                            </button>

                            <button
                                    class="buy action-btn"
                                    type="button"
                                    aria-label="Mua ngay"
                                    th:onclick="|window.location.href='@{/product/{id}(id=${product.id})}'|">
                                Mua ngay
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <form th:action="@{/home/homepage}" method="get" style="margin-bottom: 20px;">
                    <label for="sort">S·∫Øp x·∫øp theo gi√°: </label>
                    <select id="sort" name="sort" onchange="this.form.submit()">
                        <option th:value="default" th:selected="${currentSort == 'default'}">M·∫∑c ƒë·ªãnh</option>
                        <option th:value="priceAsc" th:selected="${currentSort == 'priceAsc'}">Gi√° tƒÉng d·∫ßn</option>
                        <option th:value="priceDesc" th:selected="${currentSort == 'priceDesc'}">Gi√° gi·∫£m d·∫ßn</option>
                    </select>
                </form>

                <h2>T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
                <div class="sub">Danh s√°ch ƒë·∫ßy ƒë·ªß s·∫£n ph·∫©m</div>

                <div class="grid-all" id="allGrid">
                    <!-- Thymeleaf render .card ·ªü ƒë√¢y -->
                    <div th:each="product : ${products}" class="card">
                        <div class="thumb" th:style="|background-image: url('${product.img_url}')|"></div>
                        <h3 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h3>
                        <div class="meta">
                            <span class="price"
                                  th:text="${#lists.isEmpty(product.variants) ? 'Li√™n h·ªá' : product.variants[0].price + ' ƒë'}">Gi√°</span>
                        </div>
                        <div class="actions-row">
                            <button
                                    class="add-to-cart action-btn"
                                    type="button"
                                    th:attr="data-product-id=${product.id}"
                                    aria-label="Th√™m v√†o gi·ªè h√†ng"
                                    th:onclick="|window.location.href='/product/${product.id}?from=addcart'|">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42c-.14 0-.25-.11-.25-.25l.03-.12L15.1 9H20V7h-5.21l-.94-2H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                Th√™m V√†o Gi·ªè H√†ng
                            </button>
                            <button class="buy action-btn"
                                    type="button"
                                    th:onclick="|window.location.href='/product/${product.id}'|"
                                    aria-label="Mua ngay">
                                Mua ngay
                            </button>

                        </div>
                    </div>
                </div>

                <div id="noResults" class="no-results" style="display:none;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o kh·ªõp.</div>

                <!-- ======== Pagination ======== -->
                <div th:if="${totalPages != null and totalPages > 1}" class="pagination" role="navigation" aria-label="Ph√¢n trang s·∫£n ph·∫©m">
                    <!-- Prev -->
                    <a th:if="${hasPrev}"
                       th:href="${currentCategory != null} ? @{/home/category/{id}(id=${currentCategory.id},page=${currentPage - 1})} : @{/home/homepage(page=${currentPage - 1})}"
                       class="page-btn">‚Üê Tr∆∞·ªõc</a>

                    <!-- Pages (hi·ªÉn th·ªã 1-based cho ng∆∞·ªùi d√πng, model d√πng 0-based) -->
                    <span th:each="p : ${#numbers.sequence(0, totalPages - 1)}">
                        <a th:classappend="${p == currentPage} ? ' page-num active' : ' page-num'"
                           th:href="${currentCategory != null} ? @{/home/category/{id}(id=${currentCategory.id},page=${p})} : @{/home/homepage(page=${p})}"
                           th:text="${p + 1}">1</a>
                    </span>

                    <!-- Next -->
                    <a th:if="${hasNext}"
                       th:href="${currentCategory != null} ? @{/home/category/{id}(id=${currentCategory.id},page=${currentPage + 1})} : @{/home/homepage(page=${currentPage + 1})}"
                       class="page-btn">Ti·∫øp ‚Üí</a>
                </div>
                <!-- ======== end pagination ======== -->

            </div>
        </div>
    </section>
</main>

<!-- Toast element (t·∫°o ƒë·ªông n·∫øu ch∆∞a c√≥) v√† script x·ª≠ l√Ω cart + t√¨m ki·∫øm + header compact -->
<script>
    /* =========================
       Local Storage Cart Utils (c·∫≠p nh·∫≠t UI cho m·ªçi .cart-btn)
       ========================= */

    function updateCartCountUI() {
        const cart = typeof loadCart === 'function' ? loadCart() : [];
        const total = cart.reduce((s, it) => s + (it.qty||1), 0);

        // C·∫≠p nh·∫≠t t·∫•t c·∫£ ph·∫ßn t·ª≠ c√≥ class .cart-btn
        document.querySelectorAll('.cart-btn').forEach(btn => {
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42l.72-1.55L17 7H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/></svg>`;
            const text = ` <span class="cart-text">Gi·ªè h√†ng (${total})</span>`;
            btn.innerHTML = svg + text;
        });
    }

    // Search input clear button behavior
    document.addEventListener('DOMContentLoaded', function() {
        const avatar = document.getElementById('userAvatar');
        const dropdown = document.getElementById('userDropdown');

        if (avatar && dropdown) {
            avatar.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
                dropdown.setAttribute('aria-hidden', dropdown.classList.contains('show') ? 'false' : 'true');
            });

            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && !avatar.contains(e.target)) {
                    dropdown.classList.remove('show');
                    dropdown.setAttribute('aria-hidden', 'true');
                }
            });
        }

        // search clear button
        const input = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearSearch');
        if (input && clearBtn) {
            input.addEventListener('input', function() {
                if (input.value && input.value.trim().length > 0) {
                    clearBtn.classList.remove('hidden');
                } else {
                    clearBtn.classList.add('hidden');
                }
            });
            clearBtn.addEventListener('click', function() {
                input.value = '';
                clearBtn.classList.add('hidden');
                // n·∫øu c√≥ ch·ª©c nƒÉng l·ªçc, submit form ho·∫∑c call search l·∫°i t·∫°i ƒë√¢y
            });
        }

        updateCartCountUI();
    });

    // N·∫øu b·∫°n c√≥ logic th√™m v√†o cart (th√™m sp), h√£y g·ªçi updateCartCountUI() sau khi c·∫≠p nh·∫≠t localStorage.
</script>

</body>
</html>