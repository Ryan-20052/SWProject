<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Shop</title>
    <link rel="stylesheet" href="/homepage.css" th:href="@{/homepage.css}" />
    <script src="/homepage.js"></script>
    <style>
        /* --------------------
           Bi·∫øn m√†u ch√≠nh
           -------------------- */
        :root {
            --blue: #2563eb;
            --blue-dark: #1d4ed8;
            --accent: #f43f5e; /* m√†u ƒë·ªè/ƒë·∫≠m cho n√∫t th√™m gi·ªè */
            --white-90: rgba(255,255,255,0.9);
        }

        /* --------------------
           Reset & body
           -------------------- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f8f9fa;
            color: #111;
            transition: padding-top 160ms ease;
        }

        /* --------------------
           Header (fixed) & search
           -------------------- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--blue);
            color: white;
            padding: 15px 20px;
            display: block;
            transition: all 0.28s cubic-bezier(.2,.9,.2,1);
            z-index: 1200;
            will-change: padding, box-shadow, backdrop-filter;
            backdrop-filter: blur(0px);
        }

        /* compact state khi scroll */
        header.compact {
            box-shadow: 0 4px 18px rgba(16,24,40,0.12);
            backdrop-filter: blur(4px);
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        header h1 {
            font-size: 20px;
            margin: 0;
            white-space: nowrap;
            transition: transform 0.28s, font-size 0.28s;
        }

        /* Khi compact, thu nh·ªè ti√™u ƒë·ªÅ 1 ch√∫t */
        header.compact .header-inner h1 {
            transform: translateY(-1px);
            font-size: 16px;
        }

        /* search box ch·ª©a input + clear */
        .search-box { flex: 1; display: flex; justify-content: center; }
        .search-controls { display: flex; gap: 8px; align-items: center; width: 100%; max-width: 600px; }
        .search-controls input {
            flex: 1;
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            outline: none;
            box-sizing: border-box;
            transition: padding 0.2s, font-size 0.2s;
        }
        header.compact .search-controls input {
            padding: 8px 10px;
            font-size: 13px;
        }
        .search-clear {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        .search-clear.hidden { display: none; opacity: 0; }

        /* Actions (Login/Register/Cart) */
        .actions { display: flex; gap: 8px; align-items: center; }

        /* Reset chung cho n√∫t trong header */
        .actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-sizing: border-box;
            transition: transform 140ms ease, box-shadow 140ms ease, opacity 160ms ease;
            white-space: nowrap;
        }

        /* N√∫t ƒêƒÉng nh·∫≠p: outline tr·∫Øng (trong su·ªët) */
        .auth-login {
            background: transparent;
            color: var(--white-90);
            border: 1.5px solid rgba(255,255,255,0.18);
            padding: 8px 14px;
        }
        .auth-login:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(37,99,235,0.08); }

        /* N√∫t ƒêƒÉng k√Ω: filled ƒë·ªÉ n·ªïi b·∫≠t */
        .auth-register {
            background: white;
            color: var(--blue);
            border: 1.5px solid rgba(0,0,0,0.06);
            padding: 9px 14px;
        }
        .auth-register:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,99,235,0.08); }

        /* N√∫t Gi·ªè h√†ng: t√¥ng nh·∫•n nh·∫π */
        #cartBtn {
            background: rgba(255,255,255,0.12);
            color: white;
            border: 1px solid rgba(255,255,255,0.08);
            padding: 8px 12px;
            border-radius: 8px;
        }
        #cartBtn:hover { background: rgba(255,255,255,0.16); transform: translateY(-2px); }

        /* Khi header compact, gi·∫£m k√≠ch th∆∞·ªõc c√°c n√∫t 1 ch√∫t */
        header.compact .actions button { padding: 6px 10px; font-size: 13px; }

        /* --------------------
           Navigation
           -------------------- */
        nav { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.06); margin-top: 0; }
        .nav-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; gap: 24px; padding: 10px 20px; font-weight: 600; }

        /* --------------------
           Banner & layout
           -------------------- */
        .banner { margin: 20px auto; padding: 34px; border-radius: 12px; background: linear-gradient(90deg,#4ade80,#3b82f6); color: white; text-align: center; max-width: 1200px }

        .products { padding: 20px; text-align: center; max-width: 1200px; margin: 0 auto }
        .section-inner { width: 100%; max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
        .content-inner { display: flex; flex-direction: column; align-items: flex-start; width: max-content; }
        .content-inner h2 { margin-bottom: 8px; text-align: left; }
        .content-inner .sub { color: #666; font-size: 14px; margin-bottom: 14px; text-align: left }

        /* Grid s·∫£n ph·∫©m */
        .grid-featured { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }
        .grid-all { display: grid; grid-template-columns: repeat(4, 260px); gap: 30px; justify-content: center; align-items: start; }

        /* Card */
        .card { background: white; border-radius: 10px; padding: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); transition: 0.25s; width: 100%; }
        .card:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .thumb { height: 140px; border-radius: 8px; background-size: cover; background-position: center; margin-bottom: 10px; }
        .card h3 { font-size: 15px; margin: 6px 0; height: 40px; overflow: hidden; text-align: left }
        .meta { display: flex; gap: 8px; align-items: center; justify-content: space-between; }
        .price { color: #059669; font-weight: 700 }

        /* Buttons: th·ªëng nh·∫•t k√≠ch th∆∞·ªõc */
        .card .action-btn { margin-top: 8px; width: 100%; padding: 12px 14px; border-radius: 8px; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; box-sizing: border-box; transition: all 180ms ease; }

        .card .add-to-cart {
            display: inline-flex; align-items: center; gap: 10px; justify-content: center;
            background: transparent; border: 1.5px solid var(--accent);
            color: var(--accent); font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 180ms ease; box-sizing: border-box; text-decoration: none;
            padding: 12px 14px;
            width: 100%;
        }
        .card .add-to-cart svg { width: 18px; height: 18px; flex-shrink: 0; fill: currentColor; }
        .card .add-to-cart:hover { background: rgba(244,63,94,0.08); transform: translateY(-2px); }

        .card .buy {
            margin-top: 8px;
            width: 100%;
            padding: 12px 14px;
            background: var(--accent);
            color: white;
            border: 1.5px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-sizing: border-box;
            transition: background 160ms ease;
        }
        .card .buy:hover { background: #d6334b; }

        /* highlight text khi t√¨m ki·∫øm */
        .highlight { background: linear-gradient(90deg,#fff9c4,#fff3b0); padding: 0 4px; border-radius: 3px; }

        /* Hi·ªÉn th·ªã khi kh√¥ng c√≥ k·∫øt qu·∫£ t√¨m */
        .no-results { text-align: center; color: #666; padding: 24px; width: 100%; }

        /* toast nh·ªè khi th√™m gi·ªè h√†ng */
        .toast-cart { position: fixed; right: 20px; bottom: 20px; background: #111; color: white; padding: 10px 14px; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); transform: translateY(10px); opacity: 0; transition: all 240ms ease; z-index: 9999; }
        .toast-cart.show { opacity: 1; transform: translateY(0); }

        /* Responsive: r√∫t g·ªçn layout header cho mobile */
        @media (max-width: 880px) {
            .header-inner { padding: 0 12px; gap: 10px; }
            .search-box { display: none; } /* ·∫©n search tr√™n mobile header ƒë·ªÉ g·ªçn (t√πy b·∫°n) */
            .nav-inner { padding: 8px 12px; gap: 12px; overflow-x:auto; }
            .grid-featured, .grid-all { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<script>
    function updateCartCountUI() {
        const cart = loadCart();
        const total = cart.reduce((s, it) => s + (it.qty||1), 0);
        document.querySelectorAll('#cartBtn').forEach(btn => {
            btn.innerText = `Gi·ªè h√†ng (${total})`;
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        const avatar = document.getElementById('userAvatar');
        const dropdown = document.getElementById('userDropdown');

        if (avatar && dropdown) {
            avatar.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('show');
                dropdown.setAttribute('aria-hidden', dropdown.classList.contains('show') ? 'false' : 'true');
            });

            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && !avatar.contains(e.target)) {
                    dropdown.classList.remove('show');
                    dropdown.setAttribute('aria-hidden', 'true');
                }
            });
        }

        updateCartCountUI();
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const status = params.get("status");
        if (!status) return;

        const alertBox = document.createElement("div");
        alertBox.innerText = status === "success"
            ? "üéâ Thanh to√°n th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng."
            : "‚ùå Thanh to√°n th·∫•t b·∫°i ho·∫∑c b·ªã h·ªßy.";
        alertBox.style.position = "fixed";
        alertBox.style.top = "20px";
        alertBox.style.left = "50%";
        alertBox.style.transform = "translateX(-50%)";
        alertBox.style.backgroundColor = status === "success" ? "#28a745" : "#dc3545";
        alertBox.style.color = "white";
        alertBox.style.padding = "12px 24px";
        alertBox.style.borderRadius = "8px";
        alertBox.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
        alertBox.style.zIndex = "9999";
        alertBox.style.fontWeight = "600";
        alertBox.style.fontSize = "15px";
        document.body.appendChild(alertBox);

        setTimeout(() => alertBox.remove(), 2000);
    });
</script>

<body>
<header id="siteHeader">
    <div class="header-inner">
        <h1>License Shop</h1>

        <div class="search-box" aria-hidden="false">
            <div class="search-controls" role="search" aria-label="T√¨m s·∫£n ph·∫©m">
                <input id="searchInput" type="text" placeholder="T√¨m s·∫£n ph·∫©m theo t√™n, t·ª´ kho√°..." aria-label="T√¨m s·∫£n ph·∫©m"/>
                <button id="clearSearch" class="search-clear hidden" aria-label="X√≥a t√¨m ki·∫øm">X</button>
            </div>
        </div>

        <!-- Actions (Login / Register / Cart) -->
        <div class="actions">
            <!-- N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p -->
            <div th:if="${customer == null}">
                <a th:href="@{/login.html}" class="auth-login" role="button">ƒêƒÉng nh·∫≠p</a>
                <a th:href="@{/register.html}" class="auth-register" role="button">ƒêƒÉng k√Ω</a>
                <button id="cartBtn" class="cart-btn">Gi·ªè h√†ng (0)</button>
            </div>

            <!-- N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p -->
            <div class="user-menu" th:if="${customer != null}">
                <div id="userAvatar" class="user-avatar" title="T√†i kho·∫£n">
                    <!-- N·∫øu c√≥ ·∫£nh avatar th√¨ hi·ªÉn th·ªã t·ª´ endpoint -->
                    <img th:if="${customer.avatar != null}"
                         th:src="@{'/customer/avatar/' + ${customer.id}}" alt="avatar" class="avatar-img"/>

                    <!-- N·∫øu kh√¥ng c√≥ ·∫£nh th√¨ l·∫•y ch·ªØ c√°i ƒë·∫ßu -->
                    <span th:if="${customer.avatar == null}"
                          th:text="${#strings.substring(customer.name,0,1).toUpperCase()}">U</span>
                </div>

                <div id="userDropdown" class="dropdown">
                    <div class="item item-name" th:text="${customer.name}">T√™n user</div>
                    <a th:href="@{/customer/profile}" class="item">Profile</a>
                    <a th:href="@{/purchasedlicenses}" class="item">Purchased License</a>

                    <!-- S·ª≠ d·ª•ng form POST t·ªõi /auth/customer/logout -->
                    <form th:action="@{/auth/customer/logout}" method="post" style="margin:0;">
                        <button type="submit" class="item" style="width:100%;background:none;border:none;text-align:left;cursor:pointer;">
                            Log out
                        </button>
                    </form>
                </div>

                <button id="cartBtnL" class="cart-btn">Gi·ªè h√†ng (0)</button>
            </div>

        </div>
    </div>
</header>

<nav style="margin-top:0;">
    <div class="nav-inner" id="mainNav">
        <span>Gi·∫£i tr√≠</span>
        <span>L√†m vi·ªác</span>
        <span>H·ªçc t·∫≠p</span>
        <span>windows</span>
        <span>VPN</span>
    </div>
</nav>

<!-- Th√™m 1 spacer ·ªü tr√™n n·ªôi dung: s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS ƒë·ªÉ tr√°nh nh·∫£y -->
<main id="pageContent" style="margin-top:0;">
    <div style="height: 8px;"></div>

    <div class="banner">
        <h2>Khuy·∫øn m√£i si√™u hot!</h2>
        <p>Gi·∫£m gi√° l√™n t·ªõi 80% cho c√°c ph·∫ßn m·ªÅm b·∫£n quy·ªÅn</p>
    </div>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
                <div class="sub">Danh s√°ch nh·ªØng s·∫£n ph·∫©m theo xu h∆∞·ªõng</div>
                <div class="grid-featured" id="featuredGrid"></div>
            </div>
        </div>
    </section>

    <section class="products">
        <div class="section-inner">
            <div class="content-inner">
                <h2>T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
                <div class="sub">Danh s√°ch ƒë·∫ßy ƒë·ªß s·∫£n ph·∫©m</div>
                <div class="grid-all" id="allGrid">
                    <!-- Thymeleaf render .card ·ªü ƒë√¢y -->
                    <div th:each="product : ${products}" class="card">
                        <div class="thumb" th:style="|background-image: url('${product.img_url}')|"></div>
                        <h3 th:text="${product.name}">T√™n s·∫£n ph·∫©m</h3>
                        <div class="meta">
                            <span class="price"
                                  th:text="${#lists.isEmpty(product.variants) ? 'Li√™n h·ªá' : product.variants[0].price + ' ƒë'}">Gi√°</span>
                        </div>
                        <div class="actions-row">
                            <button
                                    class="add-to-cart action-btn"
                                    type="button"
                                    th:attr="data-product-id=${product.id},
                                         data-variant-id=${#lists.isEmpty(product.variants) ? 0 : product.variants[0].id},
                                         data-price=${#lists.isEmpty(product.variants) ? 0 : product.variants[0].price}"
                                    aria-label="Th√™m v√†o gi·ªè h√†ng">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.45C8.89 16.37 9.32 17 10 17h8v-2h-7.42c-.14 0-.25-.11-.25-.25l.03-.12L15.1 9H20V7h-5.21l-.94-2H7zM10 20a2 2 0 100 4 2 2 0 000-4zm8 0a2 2 0 100 4 2 2 0 000-4z"/>
                                </svg>
                                Th√™m V√†o Gi·ªè H√†ng
                            </button>
                            <button class="buy action-btn"
                                    type="button"
                                    th:onclick="|window.location.href='/product/${product.id}'|"
                                    aria-label="Mua ngay">
                                Mua ngay
                            </button>

                        </div>
                    </div>
                </div>

                <div id="noResults" class="no-results" style="display:none;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o kh·ªõp.</div>
            </div>
        </div>
    </section>
</main>

<!-- Toast element (t·∫°o ƒë·ªông n·∫øu ch∆∞a c√≥) v√† script x·ª≠ l√Ω cart + t√¨m ki·∫øm + header compact -->
<script>
    /* =========================
       Local Storage Cart Utils
       ========================= */

</script>

</body>
</html>