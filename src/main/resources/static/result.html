<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Kết quả thanh toán VNPAY</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
        .success { color: green; font-size: 20px; font-weight: bold; }
        .fail { color: red; font-size: 20px; font-weight: bold; }
        .info { margin-top: 20px; font-size: 16px; text-align: left; display: inline-block; min-width: 320px; }
        .meta { margin-top: 12px; color: #666; font-size: 13px; }
        button { margin-top: 18px; padding: 8px 14px; border-radius: 6px; border: 1px solid #ccc; background: #f7f7f7; cursor: pointer; }
        .note { color: #555; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>
<h2>Kết quả thanh toán</h2>
<p id="result"></p>

<div class="info" id="orderInfo"></div>

<div class="meta" id="metaInfo"></div>

<div>
    <button onclick="goHome()">Quay về trang chủ</button>
    <button onclick="reload()">Làm mới</button>
</div>

<script>
    function parseQuery() {
        const params = {};
        const query = window.location.search.substring(1);
        if (!query) return params;
        const pairs = query.split('&');
        for (const pair of pairs) {
            if (!pair) continue;
            const [rawKey, rawVal] = pair.split('=');
            const key = decodeURIComponent(rawKey || '').trim();
            const val = decodeURIComponent(rawVal || '').trim();
            if (key) params[key] = val;
        }
        return params;
    }

    function formatAmount(amountString) {
        if (!amountString) return "Không có";
        const num = Number(amountString);
        if (isNaN(num)) return amountString;
        return num.toLocaleString('vi-VN') + " VND";
    }

    function goHome() { window.location.href = '/'; }
    function reload() { window.location.reload(); }

    const params = parseQuery();
    const resultEl = document.getElementById('result');
    const orderInfoEl = document.getElementById('orderInfo');
    const metaEl = document.getElementById('metaInfo');

    // Xác định trạng thái
    const status = (params['status'] || '').toLowerCase();
    if (status === 'success') {
        resultEl.textContent = 'Thanh toán thành công!';
        resultEl.className = 'success';
    } else if (status === 'fail') {
        resultEl.textContent = 'Thanh toán thất bại! (Mã lỗi: ' + (params['code'] || '-') + ')';
        resultEl.className = 'fail';
    } else {
        resultEl.textContent = 'Không rõ trạng thái thanh toán!';
        resultEl.className = 'fail';
    }

    // Thông tin chi tiết đơn hàng & khách hàng
    orderInfoEl.innerHTML = `
        <p><strong>Mã đơn hàng:</strong> ${params['orderCode'] || '-'}</p>
        <p><strong>ID đơn hàng:</strong> ${params['orderId'] || '-'}</p>
        <p><strong>Số tiền:</strong> ${formatAmount(params['totalAmount'])}</p>
        <hr>
        <p><strong>Tên khách hàng:</strong> ${params['customerName'] || '-'}</p>
        <p><strong>Email khách hàng:</strong> ${params['customerEmail'] || '-'}</p>
    `;

    metaEl.innerHTML = `
        <p>Trạng thái: ${status.toUpperCase()}</p>
        <p>Mã phản hồi: ${params['code'] || '-'}</p>
    `;

    console.log("Query params:", params);
</script>
</body>
</html>