<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard</title>
    <style>
        :root{--blue:#2563eb;--blue-dark:#1d4ed8;--red:#dc2626;--green:#059669}
        body { font-family: Arial, sans-serif; margin:0; background:#f8f9fa; color:#111 }
        header { background: var(--blue); color:white; padding:15px 20px; display:flex; justify-content:center; align-items:center; }
        .header-inner { width:1200px; display:flex; justify-content:space-between; align-items:center; }
        header h1 { font-size:20px; margin:0; }

        nav { background:white; box-shadow:0 2px 4px rgba(0,0,0,0.06); }
        .nav-inner { width:1200px; margin:0 auto; display:flex; gap:24px; padding:10px 20px; font-weight:600; }

        .dashboard { max-width:1200px; margin:20px auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08) }
        .dashboard h2 { margin-bottom:16px }
        .actions { margin-bottom:14px }
        .actions button { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; background:var(--green); color:white; }
        .actions button:hover { background:#047857 }

        table { width:100%; border-collapse:collapse; margin-top:10px }
        th, td { border:1px solid #ddd; padding:10px; text-align:left }
        th { background:#f3f4f6 }
        tr:hover { background:#f9fafb }

        .btn { padding:6px 10px; border:none; border-radius:4px; cursor:pointer; font-size:13px }
        .btn-edit { background:var(--blue); color:white }
        .btn-edit:hover { background:var(--blue-dark) }
        .btn-del { background:var(--red); color:white }
        .btn-del:hover { background:#b91c1c }

        /* Modal */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center }
        .modal-content { background:white; padding:20px; border-radius:8px; width:400px }
        .modal-content h3 { margin-top:0 }
        .modal-content input { width:100%; padding:8px; margin:6px 0; border:1px solid #ddd; border-radius:6px }
        .modal-actions { margin-top:10px; display:flex; justify-content:flex-end; gap:10px }
    </style>
</head>
<body>
<header>
    <div class="header-inner" style="display:flex; align-items:center; gap:20px; width:100%;">
        <h1 style="margin:0; font-weight:bold;">Manager Dashboard</h1>
        <div style="margin-left:10px;">Xin chào, Quản lý</div>
        <button onclick="logout()"
                style="margin-left:auto; padding:6px 12px; border:none; border-radius:4px; background:red; color:white; cursor:pointer;">
            Đăng xuất
        </button>
    </div>
</header>

<nav>
    <div class="nav-inner">
        <a href="products.html">Quản lý sản phẩm</a>
        <a href="orders.html">Đơn hàng</a>
        <a href="financial.html">Báo cáo tài chính</a>
        <a href="report.html">Báo cáo khách hàng</a>
    </div>

</nav>

<div class="dashboard">
    <h2>Danh sách sản phẩm</h2>
    <div class="actions">
        <button onclick="openModal()">+ Thêm sản phẩm</button>
    </div>
    <table id="productTable">
        <thead>
        <tr>
            <th>STT</th>
            <th>Ảnh</th>
            <th>Tên sản phẩm</th>
            <th>Thời hạn</th>
            <th>Giá</th>
            <th>Số lượng</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal" id="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Thêm sản phẩm</h3>
        <input type="hidden" id="editId">
        <input type="text" id="name" placeholder="Tên sản phẩm">
        <input type="number" id="price" placeholder="Giá">
        <select id="duration">
            <option value="">Chọn thời hạn</option>
            <option value="15">15 ngày</option>
            <option value="30">30 ngày</option>
            <option value="90">90 ngày</option>
        </select>
        <div class="modal-actions">
            <button onclick="closeModal()">Hủy</button>
            <button onclick="saveProduct()" style="background:var(--blue);color:white">Lưu</button>
        </div>
    </div>
</div>

<script>

    function logout() {
        // Xử lý đăng xuất, ví dụ chuyển về trang login
        window.location.href = "login.html";
    }

    async function loadProducts(){
        const res = await fetch("http://localhost:8080/manage/loadVariant");
        const data = await res.json();
        renderTable(data);
    }

    function renderTable(variantList){
        const tbody = document.querySelector("#productTable tbody");
        tbody.innerHTML = "";
        variantList.forEach((v,i)=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
        <td>${i+1}</td>
        <td><img src="${v.product.urlImg}" alt="Ảnh sản phẩm" style="width:60px; height:auto;"></td>

        <td>${v.name}</td>
        <td>${v.duration}</td>
        <td>${v.price}</td>
        <td>${v.stockQuantity}</td>
        <td>
          <button class="btn btn-edit" onclick="editProduct(${v.id})">Sửa</button>
          <button class="btn btn-del" onclick="deleteProduct(${v.id})">Xóa</button>
        </td>
      `;
            tbody.appendChild(tr);
        });
    }

    function openModal(edit=false){
        document.getElementById("modal").style.display="flex";
        if(!edit){
            document.getElementById("modalTitle").textContent="Thêm sản phẩm";
            document.getElementById("editId").value="";
            document.getElementById("name").value="";
            document.getElementById("price").value="";
            document.getElementById("oldPrice").value="";
            document.getElementById("discount").value="";
        }
    }
    function closeModal(){ document.getElementById("modal").style.display="none" }

    async function saveProduct(){
        const id = document.getElementById("editId").value;
        const product = {
            name: document.getElementById("name").value,
            price: +document.getElementById("price").value,
            oldPrice: +document.getElementById("oldPrice").value,
            discount: +document.getElementById("discount").value
        };

        let method = id ? "PUT" : "POST";
        let url = id ? `${API_URL}/${id}` : API_URL;

        await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(product)
        });

        closeModal();
        loadProducts();
    }

    async function editProduct(id){
        const res = await fetch(`http://localhost:8080/manage/loadVariant/${id}`);
        const p = await res.json();
        document.getElementById("modalTitle").textContent="Sửa sản phẩm";
        document.getElementById("editId").value=p.id;
        document.getElementById("name").value=p.name;
        document.getElementById("price").value=p.price;
        document.getElementById("oldPrice").value=p.oldPrice;
        document.getElementById("discount").value=p.discount;
        openModal(true);
    }

    async function deleteProduct(id){
        if(confirm("Xóa sản phẩm này?")){
            await fetch(`${API_URL}/${id}`, { method:"DELETE" });
            loadProducts();
        }
    }

    loadProducts();
</script>
</body>
</html>
